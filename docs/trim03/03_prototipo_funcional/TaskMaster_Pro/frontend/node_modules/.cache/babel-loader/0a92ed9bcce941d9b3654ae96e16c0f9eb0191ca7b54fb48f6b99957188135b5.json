{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport api from '@/services/api';\nexport default {\n  mounted() {\n    document.title = \"Usuarios | TaskMaster Pro\";\n    this.getUsers();\n  },\n  data() {\n    return {\n      searchQuery: '',\n      users: [],\n      username: ''\n    };\n  },\n  created() {\n    this.getUsername(); // Obtiene el nombre del usuario al cargar el componente\n  },\n  computed: {\n    filteredUser() {\n      return this.users.filter(user => {\n        const fullName = `${user.nombre} ${user.apellidos}`.toLowerCase();\n        return fullName.includes(this.searchQuery.toLowerCase());\n      });\n    }\n  },\n  methods: {\n    async getUsers() {\n      try {\n        const response = await api.get('/user');\n        this.users = response.data.data;\n        console.log(response.data);\n      } catch (error) {\n        if (error.response && error.response.data) {\n          const serverErrors = error.response.data;\n          if (serverErrors.message === 'Error fetching users: ') {\n            console.log(serverErrors.message);\n            alert(serverErrors.message);\n          } else if (serverErrors.mensaje === 'Usuario no autenticado') {\n            console.log(serverErrors.mensaje);\n            alert(`${serverErrors.mensaje}, debes loguearte para acceder a las funciones de esta ruta.`);\n            this.$router.push('/iniciar-sesion');\n          } else if (serverErrors.mensaje === 'No tienes permisos para realizar esta acción.') {\n            console.log(serverErrors.mensaje);\n            this.$router.push('/error403');\n          } else {\n            console.log(serverErrors);\n            this.$router.push('/error500');\n          }\n        }\n      }\n    },\n    // Redirige a la página de crear usuario\n    redirectToRecoveruser() {\n      console.log('Redirigiendo a crear-usuario');\n      this.$router.push('/crear-usuario');\n    },\n    // Redirige a la página de editar usuario\n    redirectToEditUser(userId) {\n      this.$router.push({\n        name: 'EditarUsuario',\n        params: {\n          id: userId\n        }\n      });\n    },\n    async deleteUser(userId) {\n      try {\n        if (confirm('¿Estás seguro que deseas eliminar el usuario?')) {\n          const response = await api.delete(`/user/${userId}}`);\n          this.users = this.users.filter(user => user.id !== userId);\n          console.log(response.data.message);\n          alert(response.data.message);\n        }\n      } catch (error) {\n        if (error.response && error.response.data) {\n          const serverErrors = error.response.data;\n          if (serverErrors.message === 'User not exists') {\n            console.log(serverErrors.message);\n            alert(serverErrors.message);\n          } else if (serverErrors.message === 'Usuario no eliminado') {\n            console.log(serverErrors.message);\n            alert('No se puede eliminar un usuario administrador.');\n          } else if (serverErrors.mensaje === 'Usuario no autenticado') {\n            console.log(serverErrors.mensaje);\n            alert(`${serverErrors.mensaje}, debes loguearte para acceder a las funciones de esta ruta.`);\n            this.$router.push('/iniciar-sesion');\n          } else if (serverErrors.mensaje === 'No tienes permisos para realizar esta acción.') {\n            console.log(serverErrors.mensaje);\n            this.$router.push('/error403');\n          } else if (serverErrors.message === 'Error deleting user: ') {\n            console.log('Ocurrio un error inesperado del lado del servidor: ', serverErrors);\n            alert('Ocurrio un error inesperado del lado del servidor, revisa la consola para obtener más detalles');\n          } else {\n            console.log(error.response.data);\n            alert(error.response.data.mensaje);\n          }\n        }\n      }\n    },\n    async getUsername() {\n      try {\n        const response = await api.get('/session');\n        this.username = response.data.nombre;\n      } catch (error) {\n        console.log(\"Error al obtener el usuario\", error);\n        this.username = \"Invitado\";\n      }\n    },\n    irPerfil() {\n      this.$router.push('/perfil-completo');\n    }\n  }\n};","map":{"version":3,"names":["api","mounted","document","title","getUsers","data","searchQuery","users","username","created","getUsername","computed","filteredUser","filter","user","fullName","nombre","apellidos","toLowerCase","includes","methods","response","get","console","log","error","serverErrors","message","alert","mensaje","$router","push","redirectToRecoveruser","redirectToEditUser","userId","name","params","id","deleteUser","confirm","delete","irPerfil"],"sources":["C:\\xampp\\htdocs\\TaskMasterPro\\docs\\trim03\\03_prototipo_funcional\\TaskMaster_Pro\\frontend\\src\\components\\administrarUsuarios.vue"],"sourcesContent":["<template>\r\n  <div class=\"bg-custom\">\r\n    <!-- Navbar for mobile -->\r\n    <nav class=\"navbar navbar-expand-lg navbar-light bg-light d-lg-none\">\r\n      <div class=\"container-fluid\">\r\n        <button class=\"navbar-toggler\" type=\"button\" data-bs-toggle=\"offcanvas\" data-bs-target=\"#offcanvasMenu\"\r\n          aria-controls=\"offcanvasMenu\">\r\n          <span class=\"navbar-toggler-icon\"></span>\r\n        </button>\r\n        <a class=\"navbar-brand\" href=\"#\">Menú</a>\r\n      </div>\r\n    </nav>\r\n\r\n    <!-- Offcanvas for mobile menu -->\r\n    <div class=\"offcanvas offcanvas-start\" tabindex=\"-1\" id=\"offcanvasMenu\" aria-labelledby=\"offcanvasMenuLabel\">\r\n      <div class=\"offcanvas-header\">\r\n        <h5 class=\"offcanvas-title\" id=\"offcanvasMenuLabel\">Menú</h5>\r\n        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"offcanvas\" aria-label=\"Close\"></button>\r\n      </div>\r\n      <div class=\"offcanvas-body\">\r\n        <ul class=\"nav flex-column\">\r\n          <!-- Usamos router-link para redirigir en Vue -->\r\n          <li class=\"nav-item\">\r\n            <router-link to=\"/perfil-completo\" class=\"nav-link mi-link\">\r\n              <i class=\"fa-solid fa-home me-1\"></i> Inicio\r\n            </router-link>\r\n          </li>\r\n          <li class=\"nav-item\">\r\n            <router-link to=\"/administrar-usuarios\" class=\"nav-link mi-link\">\r\n              <i class=\"fa-solid fa-user-cog me-1\"></i> Usuarios\r\n            </router-link>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"container-fluid\">\r\n      <div class=\"row\">\r\n        <!-- Sidebar for larger screens -->\r\n        <div class=\"col-md-3 custom-col d-none d-lg-block\">\r\n          <img src=\"../assets/img/logos/logotipo.png\" class=\"logo-inicio\" width=\"300\" />\r\n          <ul class=\"nav flex-column\">\r\n            <li class=\"nav-item\">\r\n              <router-link to=\"/perfil-completo\" class=\"nav-link mi-link\">\r\n                <i class=\"fa-solid fa-home me-1\"></i> Inicio\r\n              </router-link>\r\n            </li>\r\n            <li class=\"nav-item\">\r\n              <router-link to=\"/administrar-usuarios\" class=\"nav-link mi-link\">\r\n                <i class=\"fa-solid fa-user-cog me-1\"></i> Usuarios\r\n              </router-link>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n\r\n        <div class=\"col custom-col-main\">\r\n          <header>\r\n            <div class=\"header d-flex justify-content-end align-items-center p-3\">\r\n              <div class=\"d-flex align-items-center\">\r\n                <span>{{ username }}</span>\r\n                <a @click=\"irPerfil\" class=\"ms-3 puntero\">\r\n                  <img src=\"../assets/img/mariposa34.jpg\" alt=\"Perfil\" class=\"rounded-circle\" width=\"40\" />\r\n                </a>\r\n              </div>\r\n            </div>\r\n          </header>\r\n\r\n          <section class=\"container-fluid mt-4\">\r\n            <div class=\"d-flex justify-content-between align-items-center mb-3\">\r\n              <div class=\"d-flex align-items-center\">\r\n                <h2>Usuarios</h2>\r\n                <!-- Usamos router-link para redirigir -->\r\n                <button class=\"btn btn-success ms-3\" @click=\"redirectToRecoveruser\"><i\r\n                    class=\"fa-solid fa-plus me-1\"></i></button>\r\n              </div>\r\n              <div class=\"d-flex align-items-center\">\r\n                <input v-model=\"searchQuery\" type=\"text\" class=\"form-control\" placeholder=\"Buscar Usuarios\">\r\n              </div>\r\n            </div>\r\n\r\n            <!-- Table responsive container -->\r\n            <div class=\"table-responsive\">\r\n              <table class=\"table table-striped\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>ID</th>\r\n                    <th>Nombre</th>\r\n                    <th>Email</th>\r\n                    <th>Telefono</th>\r\n                    <th>Rol</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  <tr v-for=\"(user) in filteredUser\" :key=\"user.id\">\r\n                    <td :id=\"user.id\">{{ user.id }}</td>\r\n                    <td :id=\"user.nombre\">{{ user.nombre }} {{ user.apellidos }}</td>\r\n                    <td :id=\"\">{{ user.email }}</td>\r\n                    <td>{{ user.telefono }}</td>\r\n                    <td>\r\n                      <select class=\"form-select\" disabled>\r\n                        <option :value=\"user.rolID\">{{ user.rolID }}</option>\r\n                      </select>\r\n                    </td>\r\n                    <td>\r\n                      <!-- Usamos el método redirectToEditUser para redirigir a editar usuario -->\r\n                      <button class=\"btn btn-sm btn-secondary\" @click=\"redirectToEditUser(user.id)\"><i\r\n                          class=\"fa-solid fa-pen\"></i></button>\r\n                      <button class=\"btn btn-sm btn-danger \" @click=\"deleteUser(user.id)\"><i class=\"fa-solid fa-trash\"></i></button>\r\n                    </td>\r\n                  </tr>\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </section>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport api from '@/services/api';\r\nexport default {\r\n  mounted() {\r\n    document.title = \"Usuarios | TaskMaster Pro\";\r\n    this.getUsers();\r\n  },\r\n  data() {\r\n    return {\r\n      searchQuery: '',\r\n      users: [],\r\n      username: ''\r\n    };\r\n  },\r\n  created() {\r\n    this.getUsername(); // Obtiene el nombre del usuario al cargar el componente\r\n  },\r\n  computed: {\r\n    filteredUser() {\r\n      return this.users.filter(user => {\r\n        const fullName = `${user.nombre} ${user.apellidos}`.toLowerCase();\r\n        return fullName.includes(this.searchQuery.toLowerCase());\r\n      })\r\n    }\r\n  },\r\n  methods: {\r\n    async getUsers() {\r\n      try {\r\n        const response = await api.get('/user');\r\n        this.users = response.data.data;\r\n        console.log(response.data);\r\n      } catch (error) {\r\n        if (error.response && error.response.data) {\r\n          const serverErrors = error.response.data;\r\n          if (serverErrors.message === 'Error fetching users: ') {\r\n            console.log(serverErrors.message);\r\n            alert(serverErrors.message);\r\n          } else if (serverErrors.mensaje === 'Usuario no autenticado') {\r\n            console.log(serverErrors.mensaje);\r\n            alert(`${serverErrors.mensaje}, debes loguearte para acceder a las funciones de esta ruta.`);\r\n            this.$router.push('/iniciar-sesion');\r\n          } else if (serverErrors.mensaje === 'No tienes permisos para realizar esta acción.') {\r\n            console.log(serverErrors.mensaje);\r\n            this.$router.push('/error403');\r\n          } else {\r\n            console.log(serverErrors);\r\n            this.$router.push('/error500');\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n    // Redirige a la página de crear usuario\r\n    redirectToRecoveruser() {\r\n      console.log('Redirigiendo a crear-usuario');\r\n      this.$router.push('/crear-usuario');\r\n    },\r\n    // Redirige a la página de editar usuario\r\n    redirectToEditUser(userId) {\r\n      this.$router.push({ name: 'EditarUsuario', params: { id: userId }});\r\n    },\r\n    async deleteUser(userId) {\r\n      try {\r\n        if (confirm('¿Estás seguro que deseas eliminar el usuario?')) {\r\n        const response =  await api.delete(`/user/${userId}}`);\r\n        this.users = this.users.filter(user => user.id !== userId);\r\n        console.log(response.data.message);\r\n        alert(response.data.message);\r\n      }\r\n      } catch (error) {\r\n        if(error.response && error.response.data){\r\n          const serverErrors = error.response.data;\r\n          if(serverErrors.message === 'User not exists'){\r\n            console.log(serverErrors.message);\r\n            alert(serverErrors.message);\r\n          } else if (serverErrors.message === 'Usuario no eliminado'){\r\n            console.log(serverErrors.message);\r\n            alert('No se puede eliminar un usuario administrador.');\r\n          } else if (serverErrors.mensaje === 'Usuario no autenticado') {\r\n            console.log(serverErrors.mensaje);\r\n            alert(`${serverErrors.mensaje}, debes loguearte para acceder a las funciones de esta ruta.`);\r\n            this.$router.push('/iniciar-sesion');\r\n          } else if (serverErrors.mensaje === 'No tienes permisos para realizar esta acción.') {\r\n            console.log(serverErrors.mensaje);\r\n            this.$router.push('/error403');\r\n          } else if(serverErrors.message === 'Error deleting user: '){\r\n            console.log('Ocurrio un error inesperado del lado del servidor: ', serverErrors);\r\n            alert('Ocurrio un error inesperado del lado del servidor, revisa la consola para obtener más detalles');\r\n          } else{\r\n            console.log(error.response.data);\r\n            alert(error.response.data.mensaje);\r\n          }\r\n        }\r\n      }\r\n    },\r\n    async getUsername(){\r\n      try{\r\n        const response = await api.get('/session');\r\n        this.username = response.data.nombre;\r\n      } catch(error){\r\n        console.log(\"Error al obtener el usuario\", error)\r\n        this.username = \"Invitado\";\r\n      }\r\n    },\r\n    irPerfil(){\r\n      this.$router.push('/perfil-completo');\r\n    }\r\n  }\r\n};\r\n</script>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}